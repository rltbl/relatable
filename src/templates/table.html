{% extends "page.html" %}

{% set range = result.range %}
{% set table = result.table %}
{% set columns = result.columns %}
{% set rows = result.rows %}

{% block styles %}
<link href="/static/main.css" rel="stylesheet">
{% endblock %}

{% block content %}
<h1>{{ table.name }}</h1>

<div id="portal" style="width: 100%; min-width: 400px; left: auto; right: auto"></div>

<p class="range">Rows {{ range.start }}-{{ range.end }} of {{ range.total }}</p>
<table class="table">
  <thead>
    <tr>
      {% for column in columns %}
      <th>{{ column.name }}</th>
      {% endfor %}
    </tr>
  </thead>
  <tbody>
    {% for row in rows %}
    <tr>
      {% for column, cell in row.cells|items %}
      <td>{{ cell.text }}</td>
      {% endfor %}
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}

{% block scripts %}
<script>
  window.rltbl = {};
  window.rltbl.site = {{site | tojson}};
  window.rltbl.result = {{result | tojson}};

  // Example: Use an autocomplete dropdown for 'penguin.island' column.
  const table = {{result.table.name | tojson}};
  var columns = {{result.columns | tojson}};
  for (var i = 0; i < columns.length; i++) {
    var kind = "text";
    if (table === "penguin" && columns[i].name === "island") {
      kind = "dropdown";
    }
    window.rltbl.result.columns[i].kind = kind;
  }

  window.rltbl.loadOptions = (row, column, inputValue, callback) => {
    const url = `/cell-options/${table}/${row}/${column}?input=${inputValue}`;
    const response = fetch(url)
      .catch(e => console.log("loadOptions", e))
      .then(response => response.json())
      .then(data => callback(data));
  };
</script>
<script defer="defer" src="/static/main.js"></script>
{% endblock %}